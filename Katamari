javascript:void function(t){var e=function(t){function e(){var t,e,o=document.createElement(%22div%22);for(t=0;t<m.length;t++)if(e=m[t],o.style.setProperty(e+%22transform%22,%22rotate(1rad) scaleX(2)%22,null),o.style.getPropertyValue(e+%22transform%22))return f=e+%22transform%22,void(p=e+%22transform-origin%22);throw alert(%22Your browser doesn't support CSS tranforms!%22),%22Your browser doesn't support CSS tranforms!%22}function o(t,e,o,n,i){var a,r;return t<i.left%3F(a=i.left-t,e<i.top%3F(r=i.top-e,n>=a*a+r*r):e<=i.bottom%3Fo>=a:(r=e-i.bottom,n>=a*a+r*r)):t<=i.right%3Fe<i.top%3Fi.top-e<=o:e<=i.bottom%3F!0:e-i.bottom<=o:(a=t-i.right,e<i.top%3F(r=i.top-e,n>=a*a+r*r):e<=i.bottom%3Fo>=a:(r=e-i.bottom,n>=a*a+r*r))}function n(t,e,o){var n;return t<o.left%3F(n=o.left-t,e<o.top%3F[o.left,o.top]:e<=o.bottom%3F[o.left,e]:[o.left,o.bottom]):t<=o.right%3Fe<o.top%3F[t,o.top]:e<=o.bottom%3F[t,e]:[t,o.bottom]:(n=t-o.right,e<o.top%3F[o.right,o.top]:e<=o.bottom%3F[o.right,e]:[o.right,o.bottom])}function i(t){return t.w*t.h*Math.min(t.w,t.h)}function a(){function t(t){void 0!==t%26%26null!==t%26%26(t.khIgnore=!0,t.style.border=u,n.push(t))}function e(t){var e;for(e=0;e<t.arrs.length;e++)t.arrs[e][t.idxs[e]]=void 0;t.el.style.visibility=%22hidden%22,t.el.khPicked=!0,delete t.arrs,delete t.idxs}var n=[],i=[],a=100,r=100,l={a:1,b:1,big:1,body:1,cite:1,code:1,dd:1,div:1,dt:1,em:1,font:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,i:1,label:1,legend:1,li:1,p:1,pre:1,small:1,span:1,strong:1,sub:1,sup:1,td:1,th:1,tt:1};this.addDomNode=t,this.addWords=function(e){function o(t){return t.tagName%26%26l[t.tagName.toLowerCase()]}function n(t,e){var i,r;if(e%26%26t.nodeType===Node.TEXT_NODE%26%26t.nodeValue.trim().length>0)return void a.push(t);if(t.childNodes%26%26!t.khIgnore)for(e=o(t),i=0,r=t.childNodes.length;r>i;i++)n(t.childNodes[i],e)}function i(e){var o,n,i=e.parentNode,a=e.nodeValue.split(/\s+/),r=e.nodeValue.split(/\S+/),l=Math.max(a.length,r.length);for(r.length>0%26%260===r[0].length%26%26r.shift(),o=0;l>o;o++)o<a.length%26%26a[o].length>0%26%26(n=document.createElement(%22span%22),n.innerHTML=a[o],i.insertBefore(n,e),t(n)),o<r.length%26%26r[o].length>0%26%26(n=document.createTextNode(r[o]),i.insertBefore(n,e));i.removeChild(e)}var a=[];n(e,o(e)),a.map(i)},this.addTagNames=function(e,o){var n,i,a,r,l=e.tagName%26%26e.tagName.toLowerCase();if(!e.khIgnore%26%26(-1!==o.indexOf(l)%26%26t(e),e.getElementsByTagName))for(n=0;n<o.length;n++)for(a=e.getElementsByTagName(o[n]),i=0,r=a.length;r>i;i++)a[i].khIgnore||t(a[i])},this.finalize=function(t,e){var o,l,s,c,d,h,u,f,p,m,g,v=Math.floor(t/a)+1,y=Math.floor(e/r)+1;for(i=new Array(v),o=0;v>o;o++)i[o]=new Array(y);for(s=0,c=n.length;c>s;s++)if(u=n[s],!u.khPicked)for(p=jQuery(u).offset(),m=jQuery(u).width(),g=jQuery(u).height(),f={el:n[s],left:p.left,right:p.left+m,top:p.top,bottom:p.top+g,w:m,h:g,x:p.left+m/2,y:p.top+g/2,diag:Math.sqrt((m*m+g*g)/4),arrs:[],idxs:[]},d=Math.floor(f.left/a),h=Math.floor(f.top/r),v=Math.floor((f.left+f.w)/a)+1,y=Math.floor((f.top+f.h)/r)+1,o=d;v>o;o++)for(l=h;y>l;l++)void 0===i[o]%26%26(i[o]=[]),void 0===i[o][l]%3Fi[o][l]=[f]:i[o][l].push(f),f.arrs.push(i[o][l]),f.idxs.push(i[o][l].length-1)},this.removeIntersecting=function(t,n,l,s){var c,d,h,u,f,p=l*l,m=Math.floor((t-l)/a),g=Math.floor((n-l)/r),v=Math.floor((t+l)/a)+1,y=Math.floor((n+l)/r)+1;for(c=m;v>c;c++)if(void 0!==i[c])for(d=g;y>d;d++)if(h=i[c][d],void 0!==h)for(u=0;u<h.length;u++)f=h[u],void 0!==f%26%26o(t,n,l,p,f)%26%26s(f)%26%26e(f)}}function r(t,e,o,a){function r(){return 4*Math.PI*w*w*w/3}function l(t){var e=r()+i(t)*S;w=Math.pow(3*e/(4*Math.PI),1/3)}function s(t){var e=n(y,b,t),o=e[0]-y,i=e[1]-b,r=Math.sqrt(o*o+i*i),s=0-Q,c=e[0]-t.left,d=e[1]-t.top,h=Math.atan2(i,o)-Q,u=r*Math.cos(h),f=r*Math.sin(h),g=t.el.cloneNode(!0),v=jQuery(t.el),M={el:g,attX:u,attY:f,attT:%22translate(%22+Math.round(u)+%22px,%22+Math.round(f)+%22px) rotate(%22+s+%22rad)%22,r:r,offTh:h,offPhi:0-B,diag:t.diag,removeR:r+t.diag,visible:!1,display:v.css(%22display%22)};I.push(M),l(t),g.style.position=%22absolute%22,g.style.left=-c+%22px%22,g.style.top=-d+%22px%22,g.style.setProperty(p,c+%22px %22+d+%22px%22,null),g.style.display=%22none%22,g.style.color=v.css(%22color%22),g.style.textDecoration=v.css(%22text-decoration%22),g.style.fontSize=v.css(%22font-size%22),g.style.fontWeight=v.css(%22font-weight%22),g.khIgnore=!0,m.appendChild(g),a%26%26a.play_pop()}function c(t){return A%26%26i(t)>r()%3F!1:(s(t),!0)}function d(){var t,e,o,n,i,a,r,l,s,c,d;for(g.style.left=y-w+%22px%22,g.style.top=b-w+%22px%22,w!=x%26%26(g.width=2*w+1,g.height=2*w+1,x=w),v.clearRect(0,0,2*w,2*w),v.fillStyle=%22%23fff%22,v.beginPath(),v.arc(w,w,w-1,0,2*Math.PI,!0),v.fill(),v.strokeStyle=C,v.beginPath(),v.arc(w,w,w-1,0,2*Math.PI,!0),v.stroke(),v.fillStyle=C,t=w+w*Math.cos(Q+Math.PI/16),e=w+w*Math.sin(Q+Math.PI/16),o=w+w*Math.cos(Q-Math.PI/16),n=w+w*Math.sin(Q-Math.PI/16),i=w+w*Math.cos(Q+15*Math.PI/16)-t,a=w+w*Math.sin(Q+15*Math.PI/16)-e,r=0;r<2*Math.PI;r+=Math.PI/7)l=(-Math.cos(B+r)+1)/2,s=(-Math.cos(B+r+Math.PI/32)+1)/2,c=Math.sin(B+r),d=Math.sin(B+r+Math.PI/32),c>0%26%26d>0%26%26(v.beginPath(),v.moveTo(t+l*i,e+l*a),v.lineTo(t+s*i,e+s*a),v.lineTo(o+s*i,n+s*a),v.lineTo(o+l*i,n+l*a),v.fill())}function h(t){var e=Q+t.offTh,o=B+t.offPhi,n=t.r*Math.cos(e),i=t.r*Math.sin(e),a=t.r*Math.cos(Q-t.offTh+Math.PI)-n,r=t.r*Math.sin(Q-t.offTh+Math.PI)-i,l=(-Math.cos(o)+1)/2,s=n+l*a,c=i+l*r,d=t.r*Math.sin(o);return 0>d%26%26Math.sqrt(s*s+c*c)+t.diag<w%3F(t.visible%26%26(t.visible=!1,t.el.style.display=%22none%22),!1):(t.visible||(t.visible=!0,t.el.style.display=t.display),t.el.style.zIndex=d>0%3F501:499,t.el.style.setProperty(f,%22translate(%22+y+%22px,%22+b+%22px) rotate(%22+Q+%22rad) scaleX(%22+Math.cos(o)+%22) %22+t.attT,null),!0)}function u(t){m.removeChild(t.el),delete t.el}var m,g,v,y=300,b=300,M=0,k=0,w=20,x=0,T=1e4,E=1e4,I=[],C=o.color,P=0,j=0,N=!1,S=o.VOL_MULT,L=o.MAX_ATTACHED_VISIBLE,A=o.CHECK_VOLS,Q=0,B=0;this.init=function(){g=document.createElement(%22canvas%22),g.width=2*w,g.height=2*w,g.style.cssText=%22position: absolute; z-index: 500;%22,t.appendChild(g),v=g.getContext(%222d%22),m=document.createElement(%22div%22),t.appendChild(m)},this.setRadius=function(t){w=t},this.getState=function(){return{x:y,y:b,vx:M,vy:k,radius:w,th:Q,phi:B}},this.setState=function(t){y=t.x,b=t.y,M=t.vx,k=t.vy,w=t.radius,Q=t.th,B=t.phi},this.setXY=function(t,e){y=t,b=e},this.setTh=function(t){Q=t},this.setPhi=function(t){B=t},this.setColor=function(t){C=t},this.setDocSize=function(t,e){T=t,E=e},this.setAccel=function(t){N=t},this.setAccelTarget=function(t,e){P=t,j=e},this.updatePhysics=function(){var t,o,n,i=y,r=b,l=!1;N%3F(n=Math.atan2(j-b,P-y),M+=.5*Math.cos(n),k+=.5*Math.sin(n)):(M*=.95,k*=.95),y+=M,b+=k,0>y-w%3F(l=!0,y=w+1,M=-M):y+w>T%26%26(l=!0,y=T-w-1,M=-M),0>b-w%3F(l=!0,b=w+1,k=-k):b+w>E%26%26(l=!0,b=E-w-1,k=-k),(0!==M||0!==k)%26%26(Q=Math.atan2(k,M),t=y-i,o=b-r,B-=Math.sqrt(t*t+o*o)/w),e.removeIntersecting(y,b,w,c),this.draw(),l%26%26a%26%26a.play_bounce()},this.draw=function(){var t,e,o=0;for(d(),t=I.length;--t>=0;)if(e=I[t],e.removeR<w)I.splice(t,1).map(u);else if(h(e)%26%26++o>L){I.splice(0,t).map(u);break}}}function l(t){return t.preventDefault(),t.returnValue=!1,!1}function s(t,e,o){function n(){i.setDocSize(jQuery(document).width()-5,jQuery(document).height()-5)}var e,i,a,s;i=new r(t,e,o,!1),i.init(),i.setXY(300,300),window.scrollTo(0,200),n(),document.addEventListener(%22touchstart%22,function(t){return 1===t.touches.length%3F(i.setAccel(!0),l(t)):void 0},!0),document.addEventListener(%22touchmove%22,function(t){i.setAccelTarget(t.touches[0].pageX,t.touches[0].pageY)},!0),document.addEventListener(%22touchend%22,function(t){return 0===t.touches.length%3F(i.setAccel(!1),l(t)):void 0},!0),-5!==o.MOUSEB%26%26(document.addEventListener(%22mousemove%22,function(t){i.setAccelTarget(t.pageX,t.pageY)},!0),document.addEventListener(%22mousedown%22,function(t){return t.button===o.MOUSEB%3F(i.setAccel(!0),l(t)):void 0},!0),document.addEventListener(%22mouseup%22,function(t){return t.button===o.MOUSEB%3F(i.setAccel(!1),l(t)):void 0},!0),0===o.MOUSEB%3Fdocument.addEventListener(%22click%22,function(t){return 0===t.button%3Fl(t):void 0},!0):2===o.MOUSEB%26%26document.addEventListener(%22contextmenu%22,l,!0)),a=setInterval(function(){i.updatePhysics()},25),s=setInterval(n,1e3)}function c(t,e,o){o.finalize(jQuery(document).width(),jQuery(document).height()),jQuery(%22%23loadingp%22).empty(),jQuery(%22<button>Start!</button>%22).click(function(){var n,i,a;jQuery(%22%23bgmusicc%22).attr(%22checked%22)%26%26((i=document.getElementById(%22khbgmusic%22))||(i=document.createElement(%22audio%22),i.id=%22khbgmusic%22,i.loop=%22loop%22,i.src=%22http://kathack.com/js/katamari.mp3%22,t.appendChild(i)),i.play()),a={color:jQuery(%22%23khcolor%22).val(),VOL_MULT:parseFloat(jQuery(%22%23vol_mult%22).val()),MAX_ATTACHED_VISIBLE:parseInt(jQuery(%22%23maxAtt%22).val(),10),CHECK_VOLS:jQuery(%22%23checkv%22).attr(%22checked%22)%3F!0:!1,MOUSEB:parseInt(jQuery(%22%23mouseb%22).val(),10)},t.removeChild(e),n=new s(t,o,a)}).appendTo(%22%23loadingp%22)}function d(t){var e=document.createElement(%22div%22);return e.style.cssText=%22position: fixed;left: 50%25;top: 50%25;width: 400px;margin-left:-200px;margin-top:-150px;border:1px solid black;background-color:white;color:black;padding:20px;font-size:13px;text-align:left;z-index:501;%22,e.innerHTML='<h1 style=%22font-size:16pt%22><a href=%22http://kathack.com/%22 style=%22color:blue;text-decoration:none;%22>Katamari!</a></h1><button style=%22position:absolute;top:0;right:0;%22>X</button><p>Controls: Hold down <b><select id=%22mouseb%22><option value=%220%22>Left-Click</option><option value=%222%22 selected=%22selected%22>Right-Click</option><option value=%22-5%22>Touch</option></select></b> to control the ball!</p><div><label>Background Music%3F <input id=%22bgmusicc%22 type=%22checkbox%22 checked=%22checked%22 /></label></div><div style=%22text-align:right; color:gray;%22><label>Katamari Color: <select id=%22khcolor%22><option value=%22%23ff0000%22 style=%22background-color:%23ff0000;color:%23ff0000%22> r </option><option value=%22%2300ff00%22 style=%22background-color:%2300ff00;color:%2300ff00%22> g </option><option value=%22%230000ff%22 style=%22background-color:%230000ff;color:%230000ff%22> b </option><option selected=%22selected%22 value=%22%237D26CD%22 style=%22background-color:%237D26CD;color:%237D26CD%22> p </option></select></label><br /> <label title=%22Lower this if the game gets slow.%22>Max Attached Objects: <select id=%22maxAtt%22><option>25</option><option>50</option><option selected=%22selected%22>75</option><option>100</option><option>9000</option></select></label><br /><label title=%22How much to grow when an object is picked up.%22>Growth Speed: <input id=%22vol_mult%22 type=%22text%22 size=%226%22 value=%221.0%22 /></label><br /><label title=%22Bigger objects require a bigger katamari to pick up.%22>Realistic Pickups%3F <input id=%22checkv%22 type=%22checkbox%22 checked=%22checked%22 /></label></div><p id=%22loadingp%22>Loading!</p>',t.appendChild(e),e.getElementsByTagName(%22button%22)[0].addEventListener(%22click%22,function(){t.removeChild(e)},!0),e}function h(){var t,e,o;t=document.createElement(%22div%22),t.khIgnore=!0,document.body.appendChild(t),o=d(t),setTimeout(function(){var n,i,a;for(window.khNodes.addWords(document.body),n=0,i=document.body.childNodes.length;i>n;n++)a=document.body.childNodes[n],window.khNodes.addTagNames(a,[%22button%22,%22canvas%22,%22iframe%22,%22img%22,%22input%22,%22select%22,%22textarea%22]);e=setInterval(function(){window.jQuery%26%26(clearInterval(e),c(t,o,window.khNodes))},100)},0)}var u=%221px solid %23bbb%22,f=null,p=null,m=[%22-webkit-%22,%22-moz-%22,%22-o-%22,%22-ms-%22,%22%22],g=!1;window.khNodes||(g=!0,window.khNodes=new a),e(),window.noMain||h()},o=t%26%26t.fn%26%26parseFloat(t.fn.jquery)>=1.7;if(o)e(t);else{var n=document.createElement(%22script%22);n.src=%22//ajax.googleapis.com/ajax/libs/jquery/1/jquery.js%22,n.onload=n.onreadystatechange=function(){var t=this.readyState;t%26%26%22loaded%22!==t%26%26%22complete%22!==t||e(jQuery.noConflict())}}document.getElementsByTagName(%22head%22)[0].appendChild(n)}(window.jQuery);
